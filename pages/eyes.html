<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eye Screening</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
</head>
<body class="eyes-page">
<div class="container my-5">
    <div class="card p-4 shadow-lg border-0 rounded-4 custom-container">
        <h2 class="text-center mb-4 eyetext">Eye Screening Form</h2>
        <form id="eyes-form">

            <!-- Screening ID -->
            <div class="mb-3">
                <label for="screening-id" class="form-label"></label>
                <input type="text" class="form-control" id="screening-id" placeholder="Screening ID" 
                       pattern="[0-9]*" title="Screening ID must contain only numbers.">
            </div>

            <!-- Discharge -->
            <label class="form-check-label" for="discharge">Discharge</label>
            <div>
                <input class="form-check-input" type="checkbox" name="discharge" id="dischargeYes" value="yes">
                <label class="form-check-label" for="dischargeYes">Yes</label>
                <input class="form-check-input" type="checkbox" name="discharge" id="dischargeNo" value="no">
                <label class="form-check-label" for="dischargeNo">No</label>
            </div>

            <div id="discharge-severity" class="mt-2" style="display: none;">
                <label for="dischargeSeverity">Severity:</label>
                <select class="form-select" id="dischargeSeverity" name="dischargeSeverity">
                    <option value="mild">Mild</option>
                    <option value="moderate">Moderate</option>
                    <option value="severe">Severe</option>
                </select>
            </div>

            <!-- Inflammation -->
            <label class="form-check-label mt-4" for="inflammation">Inflammation</label>
            <div>
                <input class="form-check-input" type="checkbox" name="inflammation" id="inflammationYes" value="yes">
                <label class="form-check-label" for="inflammationYes">Yes</label>
                <input class="form-check-input" type="checkbox" name="inflammation" id="inflammationNo" value="no">
                <label class="form-check-label" for="inflammationNo">No</label>
            </div>

            <div id="inflammation-severity" class="mt-2" style="display: none;">
                <label for="inflammationSeverity">Severity:</label>
                <select class="form-select" id="inflammationSeverity" name="inflammationSeverity">
                    <option value="mild">Mild</option>
                    <option value="moderate">Moderate</option>
                    <option value="severe">Severe</option>
                </select>
            </div>

            <!-- Squint -->
            <label class="form-check-label mt-4" for="squint">Squint</label>
            <div>
                <input class="form-check-input" type="checkbox" name="squint" id="squintYes" value="yes">
                <label class="form-check-label" for="squintYes">Yes</label>
                <input class="form-check-input" type="checkbox" name="squint" id="squintNo" value="no">
                <label class="form-check-label" for="squintNo">No</label>
            </div>

            <div id="squint-severity" class="mt-2" style="display: none;">
                <label for="squintSeverity">Severity:</label>
                <select class="form-select" id="squintSeverity" name="squintSeverity">
                    <option value="mild">Mild</option>
                    <option value="moderate">Moderate</option>
                    <option value="severe">Severe</option>
                </select>
            </div>

            <!-- Other Abnormalities -->
            <label class="form-check-label mt-4" for="otherAbnormality">Other Abnormality</label>
            <div>
                <input class="form-check-input" type="checkbox" name="otherAbnormality" id="otherAbnormalityYes" value="yes">
                <label class="form-check-label" for="otherAbnormalityYes">Yes</label>
                <input class="form-check-input" type="checkbox" name="otherAbnormality" id="otherAbnormalityNo" value="no">
                <label class="form-check-label" for="otherAbnormalityNo">No</label>
            </div>

            <div id="otherAbnormality-severity" class="mt-2" style="display: none;">
                <label for="otherAbnormalitySeverity">Severity:</label>
                <select class="form-select" id="otherAbnormalitySeverity" name="otherAbnormalitySeverity">
                    <option value="mild">Mild</option>
                    <option value="moderate">Moderate</option>
                    <option value="severe">Severe</option>
                </select>
            </div>

            <!-- Right Eye (OD) -->
            <h5 class="mt-4">Right Eye (OD)</h5>
            <div class="mb-3">
                <label for="od-sph" class="form-label">SPH:</label>
                <input type="text" class="form-control" id="od-sph" name="odVisualAcuity"
                       placeholder="e.g., 0.5" >
            </div>
            <div class="mb-3">
                <label for="od-cyl" class="form-label">CYL:</label>
                <input type="text" class="form-control" id="od-cyl" name="odVisualAcuity"
                       placeholder="e.g., 1.25" >
            </div>
            <div class="mb-3">
                <label for="od-axis" class="form-label">AXIS:</label>
                <input type="number" class="form-control" id="od-axis" name="odDiopters"
                       placeholder="e.g., 0" step="0.01" >
            </div>

            <!-- Left Eye (OS) -->
            <h5 class="mt-4">Left Eye (OS)</h5>
            <div class="mb-3">
                <label for="os-sph" class="form-label">SPH:</label>
                <input type="text" class="form-control" id="os-sph" name="osVisualAcuity"
                       placeholder="e.g., 1.25" >
            </div>
            <div class="mb-3">
                <label for="os-cyl" class="form-label">CYL:</label>
                <input type="number" class="form-control" id="os-cyl" name="osDiopters"
                       placeholder="e.g., 0.25" step="0.01" >
            </div>
            <div class="mb-3">
                <label for="os-axis" class="form-label">AXIS:</label>
                <input type="number" class="form-control" id="os-axis" name="osDiopters"
                       placeholder="e.g., 0" step="0.01" >
            </div>

            <div class="mb-3">
                <label for="os-pd" class="form-label">PD:</label>
                <input type="number" class="form-control" id="os-pd" name="osDiopters"
                       placeholder="e.g., 65" step="0.01" >
            </div>

            <!-- Wears glasses -->
            <label class="form-check-label mt-4" for="wearsGlasses">Wears glasses?</label>
            <div>
                <input class="form-check-input" type="checkbox" name="wearsGlasses" id="wearsGlassesYes" value="yes">
                <label class="form-check-label" for="wearsGlassesYes">Yes</label>
                <input class="form-check-input" type="checkbox" name="wearsGlasses" id="wearsGlassesNo" value="no">
                <label class="form-check-label" for="wearsGlassesNo">No</label>
            </div>

            <!-- Snellen Test -->
            <div id="snellenTestResults" class="mt-4">
                <label for="rightEyeSnellen">Right Eye Snellen Test Result:</label>
                <select class="form-select" id="rightEyeSnellen" name="rightEyeSnellen">
                    <option value="">Select</option>
                    <option value="6">6/6</option>
                    <option value="5">5/6</option>
                    <option value="4">4/6</option>
                    <option value="3">3/6</option>
                    <option value="2">2/6</option>
                    <option value="1">1/6</option>
                </select>
                <label for="leftEyeSnellen" class="mt-2">Left Eye Snellen Test Result:</label>
                <select class="form-select" id="leftEyeSnellen" name="leftEyeSnellen">
                    <option value="">Select</option>
                    <option value="6">6/6</option>
                    <option value="5">5/6</option>
                    <option value="4">4/6</option>
                    <option value="3">3/6</option>
                    <option value="2">2/6</option>
                    <option value="1">1/6</option>
                </select>
            </div>

            <!-- Screening Results -->
            <div class="mb-3 mt-4">
                <label for="screeningresult" class="form-label"></label>
                <select id="screeningresult" class="form-select" >
                    <option value="" disabled selected>Screening Results</option>
                    <option value="1">Refer</option>
                    <option value="2">Pass</option>
                </select>
            </div>

            <!-- Submit and Home Buttons -->
            <div class="d-flex justify-content-between mt-4">
                <button type="submit" class="btn btn-primary">Submit</button>
                <button type="button" class="btn btn-primary" id="home-btn">Home</button>
            </div>
        </form>
    </div>
</div>
<script>
    document.getElementById('eyes-form').addEventListener('submit', function(event) {
      const checkboxGroups = [
        'discharge',
        'inflammation',
        'squint',
        'otherAbnormality',
        'wearsGlasses'
      ];
  
      let allChecked = true;
      let allValid = true;
  
      // Validate if each checkbox group has a selection
      checkboxGroups.forEach(group => {
        const checkboxes = document.querySelectorAll(`input[name="${group}"]`);
        const isChecked = Array.from(checkboxes).some(checkbox => checkbox.checked);
  
        // Show error message if no option is selected
        if (!isChecked) {
          allChecked = false;
          showError(group);
        } else {
          hideError(group);
        }
      });
  
      // Validate textboxes
      const textboxes = [
        { id: 'screening-id', pattern: /^[0-9]+$/, errorMessage: 'Screening ID must contain only numbers.' },
        { id: 'od-sph', pattern: /^[+-]?(\d+(\.\d*)?|\.\d+)$/, errorMessage: 'SPH must be a valid number.' },
        { id: 'od-cyl', pattern: /^[+-]?(\d+(\.\d*)?|\.\d+)$/, errorMessage: 'CYL must be a valid number.' },
        { id: 'od-axis', pattern: /^[0-9]+$/, errorMessage: 'AXIS must be a valid number.' },
        { id: 'os-sph', pattern: /^[+-]?(\d+(\.\d*)?|\.\d+)$/, errorMessage: 'SPH must be a valid number.' },
        { id: 'os-cyl', pattern: /^[+-]?(\d+(\.\d*)?|\.\d+)$/, errorMessage: 'CYL must be a valid number.' },
        { id: 'os-axis', pattern: /^[0-9]+$/, errorMessage: 'AXIS must be a valid number.' },
        { id: 'os-pd', pattern: /^[0-9]+$/, errorMessage: 'PD must be a valid number.' }
      ];
  
      textboxes.forEach(textbox => {
        const input = document.getElementById(textbox.id);
        const isValid = textbox.pattern.test(input.value.trim());
  
        if (!isValid) {
          allValid = false;
          showTextboxError(textbox.id, textbox.errorMessage);
        } else {
          hideTextboxError(textbox.id);
        }
      });
  
      // Validate dropdowns
      const dropdowns = [
        { id: 'rightEyeSnellen', errorMessage: 'Please select a Snellen Test result for the right eye.' },
        { id: 'leftEyeSnellen', errorMessage: 'Please select a Snellen Test result for the left eye.' },
        { id: 'screeningresult', errorMessage: 'Please select a screening result.' }
      ];
  
      dropdowns.forEach(dropdown => {
        const selectElement = document.getElementById(dropdown.id);
        if (selectElement.value === '' || selectElement.value === null) {
          allValid = false;
          showDropdownError(dropdown.id, dropdown.errorMessage);
        } else {
          hideDropdownError(dropdown.id);
        }
      });
  
      // Prevent form submission if any validation fails
      if (!allChecked || !allValid) {
        event.preventDefault();
        alert('Please correct the highlighted errors and try again.');
      } else {
        alert('Data captured successfully. Click OK to finish.');
      }
    });
  
    // Function to show checkbox group error message
    function showError(group) {
      let errorElement = document.getElementById(`${group}-error`);
      if (!errorElement) {
        errorElement = document.createElement('span');
        errorElement.id = `${group}-error`;
        errorElement.className = 'text-danger';
        errorElement.textContent = 'Please select an option.';
        const checkboxes = document.querySelectorAll(`input[name="${group}"]`);
        checkboxes[0].parentNode.appendChild(errorElement);
      }
    }
  
    // Function to hide checkbox group error message
    function hideError(group) {
      const errorElement = document.getElementById(`${group}-error`);
      if (errorElement) {
        errorElement.remove();
      }
    }
  
    // Function to show textbox error message
    function showTextboxError(id, message) {
      let errorElement = document.getElementById(`${id}-error`);
      if (!errorElement) {
        errorElement = document.createElement('span');
        errorElement.id = `${id}-error`;
        errorElement.className = 'text-danger';
        errorElement.textContent = message;
        const textbox = document.getElementById(id);
        textbox.parentNode.appendChild(errorElement);
      }
    }
  
    // Function to hide textbox error message
    function hideTextboxError(id) {
      const errorElement = document.getElementById(`${id}-error`);
      if (errorElement) {
        errorElement.remove();
      }
    }
  
    // Function to show dropdown error message
    function showDropdownError(id, message) {
      let errorElement = document.getElementById(`${id}-error`);
      if (!errorElement) {
        errorElement = document.createElement('span');
        errorElement.id = `${id}-error`;
        errorElement.className = 'text-danger';
        errorElement.textContent = message;
        const dropdown = document.getElementById(id);
        dropdown.parentNode.appendChild(errorElement);
      }
    }
  
    // Function to hide dropdown error message
    function hideDropdownError(id) {
      const errorElement = document.getElementById(`${id}-error`);
      if (errorElement) {
        errorElement.remove();
      }
    }
  
    // Manage visibility of severity dropdowns
    const checkboxGroupsWithSeverity = {
      discharge: 'discharge-severity',
      inflammation: 'inflammation-severity',
      squint: 'squint-severity',
      otherAbnormality: 'otherAbnormality-severity'
    };
  
    Object.keys(checkboxGroupsWithSeverity).forEach(group => {
      const yesCheckbox = document.getElementById(`${group}Yes`);
      const noCheckbox = document.getElementById(`${group}No`);
      const severityElement = document.getElementById(checkboxGroupsWithSeverity[group]);
  
      // Show severity dropdown if "Yes" is selected
      yesCheckbox.addEventListener('change', function() {
        if (this.checked) {
          severityElement.style.display = 'block';
        }
      });
  
      // Hide severity dropdown if "No" is selected
      noCheckbox.addEventListener('change', function() {
        if (this.checked) {
          severityElement.style.display = 'none';
        }
      });
    });
  </script>  
</body>
</html>